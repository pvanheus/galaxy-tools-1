<tool id="galru" name="galru" version="@VERSION@">
    <description>Identify CRISPR types from uncorrected long reads</description>
    <macros>
        <token name="@VERSION@">0.0.1</token>
    </macros>
    <requirements>
        <container type="singularity">/qib/platforms/Informatics/transfer/outgoing/singularity/galru/galru.sif</container>
    </requirements>
    <version_command>galru --version</version_command>
    <command detect_errors="exit_code"><![CDATA[
        galru
        --technology $technology
        --gene_start_offset $gene_start_offset
        --min_mapping_quality $min_mapping_quality
        #if str($cas_input.cas_select) == "history":
            --cas_fasta $cas_input.cas_file
        #end if
        $extended
        $debug
        $verbose
        --output_file $output
        '$galru_species.fields.name'
        $fastq
    ]]>    </command>

    <inputs>
        <param name="fastq" type="data" format="fastq,fastq.gz,fastqsanger,fastqsanger.gz" label="Uncorrected long reads"/>
        <!-- DATABASE INPUT-->
        <param label="Select a species" name="galru_species" type="select">
            <options from_data_table="galru_species">
                <validator message="No species is available" type="no_options" />
            </options>
        </param>
        <conditional name="cas_input">
            <param name="cas_select" type="select" label="CAS file">
                <option selected="true" value="bundle">Use bundled CAS file</option>
                <option value="history">Use a fasta file in the history</option>
            </param>
                <when value="history">
                    <param name="cas_file" type="data" format="fasta,fasta.gz" label="Select a CAS file"/>
                </when>
            </conditional>
            <param name="technology" type="select" optional="false" label="Sequencing technology">
                <option value="map-ont">map-ont</option>
                <option value="map-pb">map-pb</option>
                <option value="ava-ont">ava-ont</option>
                <option value="ava-pb">ava-pb</option>
            </param>
            <param name="extended" type="boolean" truevalue="--extended_results" falsevalue="" checked="false" label="Output extended results" />
            <param name="gene_start_offset" type="integer" min="0" value="30" label="Only count CRISPR reads which cover this base"/>
            <param name="min_mapping_quality" type="integer" min="0" value="10" label="Minimum mapping quality score"/>
            <param name="debug" type="boolean" truevalue="--debug" falsevalue="" checked="false" label="Turn on debugging" />
            <param name="verbose" type="boolean" truevalue="--verbose" falsevalue="" checked="false" label="Turn on verbose output" />
        </inputs>

        <outputs>
            <data name="output" format="tabular" label="${tool.name} on ${on_string} Output"/>
            <data name="log" format="text" label="${tool.name} on ${on_string} Log">
                <filter>debug is True</filter>
            </data>
        </outputs>

        <help><![CDATA[

    Documentation can be found at `<https://github.com/quadram-institute-bioscience/galru>`_.

    ]]>        </help>
    </tool>
