<tool id="jgi_summarize_bam_contig_depths" name="jgi_summarize_bam_contig_depths" version="@VERSION@">
    <description>Metagenome Binning based on Abundance and Tetranucleotide frequency</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version_command" />
    <command detect_errors="exit_code"><![CDATA[
        #import re
        ## Creates symlinks for each input file based on the Galaxy 'element_identifier'
        ## Used so that a human-readable name appears in the output table (instead of 'dataset_xyz.dat')
        #set $named_input_files = ''
        #for $input_file in $in_file
            ## Add single quotes around each input file identifier
            #set $_input_file = "'{}'".format($input_file.element_identifier)
            ln -s '${input_file}' ${_input_file} &&
            #set $named_input_files = $named_input_files + ' ' + $_input_file
        #end for
        jgi_summarize_bam_contig_depths 
        --outputDepth outputDepth.txt
        --percentIdentity $percentIdentity
        #if $pairedContigs:
            --pairedContigs pairedContigs.txt
        #end if
        --unmappedFastq $unmappedFastq
        $includeEdgeBases
        --maxEdgeBases $maxEdgeBases
        $named_input_files
    ]]>    </command>

    <inputs>
        <param name="in_file" type="data" format="bam" label="Sorted bam files"/>
        <param argument="--percentIdentity" type="integer" value="97" label="The minimum end-to-end % identity of qualifying reads"/>
        <param argument="--pairedContigs" type="boolean" truevalue="true" falsevalue="false" label="Write the sparse matrix of contigs which paired reads span"/>
        <param argument="--unmappedFastq" type="text" value="unmaped" label="The prefix to output unmapped reads from each bam file suffixed by" />
        <param argument="--noIntraDepthVariance" type="boolean" truevalue="--noIntraDepthVariance" falsevalue="" checked="false" label="Do not include variance from mean depth along the contig" />
        <param argument="--showDepth" type="boolean" truevalue="--showDepth" falsevalue="" checked="false" label="Output a .depth file per bam for each contig base" />
        <param argument="--minMapQual" type="integer" value="0" label="The minimum mapping quality necessary to count the read as mapped" />
        <param argument="--weightMapQual" type="integer" value="0" label="Weight per-base depth based on the MQ of the read (i.e uniqueness)" />
        <param argument="--includeEdgeBases" type="boolean" truevalue="--includeEdgeBases" falsevalue="" checked="false" label="When calculating depth and variance, include the 1-readlength edges"/>
        <param argument="--maxEdgeBases" type="integer" value="75" label="When calculating depth and variance, and not --includeEdgeBases, the maximum length"/>
    </inputs>

    <outputs>
        <data name="depth_coverage" format="tabular" from_work_dir="outputDepth.txt" label="${tool.name} on ${on_string}: Depth Coverage" />
        <data name="depth_coverage" format="tabular" from_work_dir="pairedContigs.txt" label="${tool.name} on ${on_string}: pairedContigs">
            <filter>pairedContigs</filter>
        </data>
    </outputs>

    <tests>
        <test>
        </test>
    </tests>
    <help><![CDATA[
    Documentation can be found at `<https://bitbucket.org/berkeleylab/metabat>`_.

    ]]>    </help>
</tool>
