<tool id="ariba_run" name="ARIBA summary" version="@VERSION@">
    <description>
        Summarises the results from one or more runs of ARIBA
    </description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="version_command" />

    <command detect_errors="exit_code"><![CDATA[
        
        #import re
        ## Creates symlinks for each input file based on the Galaxy 'element_identifier'
        ## Used so that a human-readable name appears in the output table (instead of 'dataset_xyz.dat')
        #set $named_input_files = ''
        #for $input_file in $ariba_reports
            ## Add single quotes around each input file identifier
            #set $_input_file = "'{}'".format($input_file.element_identifier)
            ln -s '${input_file}' ${_input_file} &&
            #set $named_input_files = $named_input_files + ' ' + $_input_file
        #end for
        ariba summary out $named_input_files
    ]]>    </command>
    <inputs>
            <param name="ariba_reports" format="tabular,txt" type="data" label="Report (tsv) file from ARIBA run" help="This command requires one or more report tsv file generated by ARIBA run command."/>
    </inputs>

    <outputs>
        <data format="tabular" name="summary_csv" label="${tool.name} on ${on_string} report file" from_work_dir="out.tsv" />
        <data format="tabular" name="phandango_csv" label="${tool.name} on ${on_string}: Phandango CSV" from_work_dir="out.phandango.csv"/>
        <data format="text" name="phandango_tree" label="${tool.name} on ${on_string}: Phandango Tree file" from_work_dir="out.phandango.tre"/>
    </outputs>

    <help><![CDATA[
            **Usage**: ariba run [options] <prepareref_dir><reads1.fq><reads2.fq><outdir>

            Runs the local assembly pipeline. Input is dir made by prepareref, and paired
            reads
           
    ]]>    </help>

    <expand macro="citations" />
</tool>